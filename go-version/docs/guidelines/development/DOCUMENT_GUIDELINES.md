# 文档编写指南

> 本文档提供统一的文档编写指南和模板，用于创建和维护 qkflow 项目的各类文档。

---

## 📋 文档类型

qkflow 项目的文档分为以下几类：

1. **使用指南** (`guidelines/usage/`) - 面向用户的功能使用文档
2. **架构文档** (`architecture/`) - 面向开发者的技术架构文档
3. **迁移文档** (`docs/MIGRATION.md`) - 版本迁移和配置迁移指南
4. **变更日志** (`docs/CHANGELOG.md`) - 功能更新和变更记录
5. **发布文档** (`guidelines/development/`) - 版本发布流程和指南

---

## 📝 文档模板

### 1. 使用指南模板 (`guidelines/usage/`)

适用于功能使用说明、快速开始、操作指南等用户文档。

#### 模板结构

```markdown
# {功能名称} 使用指南

## 🎯 概述

{功能简介，包括功能目的、适用场景、核心特性等}

## 🚀 快速开始

### 基本使用

```bash
# 基本命令示例
qkflow {command}
```

### 常用场景

{列出 2-3 个常用使用场景}

---

## 📖 详细说明

### {功能点 1}

{详细说明}

**示例**：
```bash
# 示例命令
```

**参数说明**：
- `--flag`: {说明}

### {功能点 2}

{详细说明}

---

## ⚙️ 配置选项

### 配置文件

{配置说明}

### 环境变量

{环境变量说明}

---

## 💡 使用技巧

1. **技巧 1**：{说明}
2. **技巧 2**：{说明}

---

## ❓ 常见问题

### Q: {问题}？

A: {答案}

---

## 📚 相关文档

- [相关功能指南](./OTHER_GUIDE.md)
- [配置文档](./CONFIG_GUIDE.md)

---

## 🔄 更新记录

- **v1.0.0** - 初始版本
```

#### 章节检查清单

- [ ] 🎯 概述（功能简介、适用场景）
- [ ] 🚀 快速开始（基本使用、常用场景）
- [ ] 📖 详细说明（至少 2-3 个功能点）
- [ ] ⚙️ 配置选项（如适用）
- [ ] 💡 使用技巧（可选）
- [ ] ❓ 常见问题（至少 2-3 个）
- [ ] 📚 相关文档（至少 1-2 个链接）

---

### 2. 架构文档模板 (`architecture/`)

适用于项目结构、技术架构、设计文档等开发者文档。

#### 模板结构

```markdown
# {模块/项目名称} 架构文档

## 📋 概述

{模块/项目概述，包括定位、主要功能、设计目标等}

**技术栈**：
- {技术1}
- {技术2}

**模块统计**：
- 总代码行数：约 XXX 行
- 文件数量：X 个
- 主要组件：X 个

---

## 📁 项目结构

```
{目录树结构}
```

### 核心模块

- **`module1/`**：{说明}
- **`module2/`**：{说明}

---

## 🏗️ 架构设计

### 设计原则

1. **原则1**：{说明}
2. **原则2**：{说明}

### 核心组件

#### {组件1}

**职责**：{说明}

**关键特性**：
- {特性1}
- {特性2}

#### {组件2}

{同上}

---

## 🔄 数据流

```
{数据流图或文字描述}
```

或使用 Mermaid 图表：

```mermaid
flowchart LR
    A[起点] --> B[处理]
    B --> C[终点]
```

---

## 📝 扩展性

### 添加新功能

1. {步骤1}
2. {步骤2}

---

## 📚 相关文档

- [项目架构](../architecture/ARCHITECTURE.md)
- [其他架构文档](./OTHER_ARCHITECTURE.md)

---

## ✅ 总结

{模块/项目总结，包括设计优势、实现状态等}
```

#### 章节检查清单

- [ ] 📋 概述（包含技术栈、模块统计）
- [ ] 📁 项目结构（目录树、核心模块）
- [ ] 🏗️ 架构设计（设计原则、核心组件）
- [ ] 🔄 数据流（流程图或描述）
- [ ] 📝 扩展性（可选）
- [ ] 📚 相关文档（至少 2-3 个链接）
- [ ] ✅ 总结（设计优势、实现状态）

---

### 3. 迁移文档模板 (`docs/MIGRATION.md`)

适用于版本迁移、配置迁移、功能迁移等迁移指南。

#### 模板结构

```markdown
# {迁移类型} 迁移指南

## 🎯 为什么迁移？

| 方面 | 旧版本 | 新版本 | 改进 |
|------|--------|--------|------|
| **特性1** | {旧版本} | {新版本} | ✅ {改进} |
| **特性2** | {旧版本} | {新版本} | ✅ {改进} |

---

## 📋 前置条件

迁移前，请确保：

- ✅ {条件1}
- ✅ {条件2}
- ✅ {条件3}

---

## 🔄 迁移步骤

### Step 1: {步骤名称}

{详细说明}

```bash
# 命令示例
```

### Step 2: {步骤名称}

{详细说明}

---

## ⚙️ 配置迁移

### 旧配置

```yaml
# 旧配置示例
```

### 新配置

```yaml
# 新配置示例
```

### 迁移脚本

```bash
# 自动迁移脚本（如适用）
```

---

## 🔍 验证迁移

### 检查清单

- [ ] {检查项1}
- [ ] {检查项2}

### 验证命令

```bash
# 验证命令
```

---

## ❓ 常见问题

### Q: {问题}？

A: {答案}

---

## 🔄 回滚方案

如果迁移出现问题，可以回滚：

```bash
# 回滚步骤
```

---

## 📚 相关文档

- [新功能文档](../usage/NEW_FEATURE.md)
- [配置文档](../usage/CONFIG.md)

---

## 🔄 更新记录

- **v1.0.0** - 初始迁移指南
```

#### 章节检查清单

- [ ] 🎯 为什么迁移（对比表格）
- [ ] 📋 前置条件（至少 3 个）
- [ ] 🔄 迁移步骤（至少 3 个步骤）
- [ ] ⚙️ 配置迁移（如适用）
- [ ] 🔍 验证迁移（检查清单、验证命令）
- [ ] ❓ 常见问题（至少 2-3 个）
- [ ] 🔄 回滚方案（如适用）
- [ ] 📚 相关文档（至少 1-2 个链接）

---

### 4. 变更日志模板 (`docs/CHANGELOG.md`)

适用于功能更新、Bug 修复、变更记录等。

#### 模板结构

```markdown
# Changelog - {功能名称}

## [{版本类型}] {功能标题}

{功能简介，1-2 句话描述}

### What's New

#### 🎯 {新功能1}

{详细说明}

**使用示例**：
```bash
# 命令示例
```

**特性**：
1. **特性1**：{说明}
2. **特性2**：{说明}

#### 🎯 {新功能2}

{详细说明}

---

### Features

1. **功能1**
   - {详细说明}
   - {使用场景}

2. **功能2**
   - {详细说明}

---

### Command Flags

| Flag | 说明 | 示例 |
|------|------|------|
| `--flag1` | {说明} | `--flag1 value` |
| `--flag2` | {说明} | `--flag2` |

---

### Breaking Changes

{如有破坏性变更，在此说明}

---

### Improvements

- ✅ {改进1}
- ✅ {改进2}

---

### Bug Fixes

- 🐛 {修复1}
- 🐛 {修复2}

---

### Migration Guide

{如需要迁移，提供迁移步骤}

---

## 📚 相关文档

- [使用指南](../usage/FEATURE_GUIDE.md)
- [配置文档](../usage/CONFIG.md)

---

## 🔄 更新记录

- **v1.0.0** - 初始版本
- **v1.1.0** - {更新内容}
```

#### 章节检查清单

- [ ] [{版本类型}] {功能标题}（版本类型、标题）
- [ ] What's New（至少 1-2 个新功能）
- [ ] Features（功能列表）
- [ ] Command Flags（如适用，参数表格）
- [ ] Breaking Changes（如有）
- [ ] Improvements（改进列表）
- [ ] Bug Fixes（修复列表）
- [ ] Migration Guide（如需要）
- [ ] 📚 相关文档（至少 1-2 个链接）

---

### 5. 发布文档模板 (`guidelines/development/`)

适用于版本发布流程、发布检查清单等。

#### 模板结构

```markdown
# {发布类型} 操作指南

## 📦 发布流程

### 1. 准备发布

{准备步骤说明}

```bash
# 准备命令
```

### 2. {步骤名称}

{详细说明}

```bash
# 步骤命令
```

---

## 📋 发布检查清单

### 代码检查

- [ ] 所有测试通过
- [ ] 代码格式检查通过
- [ ] Lint 检查通过
- [ ] 无已知严重 Bug

### 文档检查

- [ ] README 已更新
- [ ] 变更日志已更新
- [ ] 使用文档已更新

### 发布检查

- [ ] 版本号已更新
- [ ] Tag 已创建
- [ ] Release Notes 已准备

---

## 🚀 发布步骤

### Step 1: {步骤}

```bash
# 命令
```

### Step 2: {步骤}

```bash
# 命令
```

---

## ⚠️ 注意事项

1. **注意1**：{说明}
2. **注意2**：{说明}

---

## 🔄 回滚方案

如果发布出现问题：

```bash
# 回滚步骤
```

---

## 📚 相关文档

- [发布流程](./development/RELEASE_GUIDELINES.md)

---

## 🔄 更新记录

- **v1.0.0** - 初始版本
```

#### 章节检查清单

- [ ] 📦 发布流程（至少 3 个步骤）
- [ ] 📋 发布检查清单（代码、文档、发布）
- [ ] 🚀 发布步骤（详细步骤）
- [ ] ⚠️ 注意事项（至少 2-3 个）
- [ ] 🔄 回滚方案（如适用）
- [ ] 📚 相关文档（至少 1-2 个链接）

---

## 🎨 文档格式规范

### Emoji 使用

统一使用以下 emoji 标识章节：

- 📋 - 概述、清单
- 🚀 - 快速开始、发布
- 📖 - 详细说明、文档
- ⚙️ - 配置、设置
- 💡 - 技巧、提示
- ❓ - 常见问题
- 🔄 - 流程、迁移、更新
- 🏗️ - 架构、设计
- 📁 - 结构、目录
- 📚 - 相关文档
- ✅ - 总结、完成
- 🎯 - 目标、功能
- ⚠️ - 注意事项
- 🔍 - 验证、检查
- 🐛 - Bug 修复

### 代码块格式

```bash
# 使用 bash 高亮显示命令
qkflow command --flag
```

```yaml
# 使用 yaml 高亮显示配置
config:
  key: value
```

```go
// 使用 go 高亮显示代码
func example() {
    // code
}
```

### 分隔线

使用 `---` 作为章节分隔线。

### 列表格式

- 使用 `-` 作为列表项标记
- 嵌套列表使用 2 个空格缩进
- 有序列表使用数字编号

### 表格格式

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 值1 | 值2 | 值3 |

---

## 📊 文档长度参考

### 使用指南

- **最小文档**：包含必选章节，约 200-300 行
- **标准文档**：包含必选章节 + 推荐章节，约 300-500 行
- **完整文档**：包含所有章节，约 500-800 行

### 架构文档

- **最小文档**：包含必选章节，约 250-350 行
- **标准文档**：包含必选章节 + 推荐章节，约 400-600 行
- **完整文档**：包含所有章节，约 600-900 行

### 迁移文档

- **最小文档**：包含必选章节，约 200-300 行
- **标准文档**：包含必选章节 + 推荐章节，约 300-500 行
- **完整文档**：包含所有章节，约 500-700 行

### 变更日志

- **最小文档**：包含必选章节，约 150-250 行
- **标准文档**：包含必选章节 + 推荐章节，约 250-400 行
- **完整文档**：包含所有章节，约 400-600 行

### 发布文档

- **最小文档**：包含必选章节，约 150-250 行
- **标准文档**：包含必选章节 + 推荐章节，约 250-400 行
- **完整文档**：包含所有章节，约 400-600 行

---

## 🔧 文档维护指南

### 📋 文档更新流程

#### 1. 确定需要更新的文档

根据变更类型选择需要更新的文档：

- **新功能** → 更新 README.md、相关使用指南、CHANGELOG.md
- **Bug 修复** → 更新 CHANGELOG.md、相关使用指南（如有影响）
- **配置变更** → 更新 README.md、相关使用指南、MIGRATION.md（如需要）
- **命令变更** → 更新 README.md、相关使用指南、QUICKSTART.md
- **架构变更** → 更新 ARCHITECTURE.md、相关开发文档

#### 2. 更新文档

```bash
# 1. 创建功能分支
git checkout -b docs/update-feature-x

# 2. 编辑相关文档
# - README.md
# - docs/guidelines/usage/XXX_GUIDELINES.md
# - docs/CHANGELOG.md

# 3. 验证链接有效性
# 检查所有内部链接是否正确

# 4. 提交更改
git add .
git commit -m "docs: update documentation for feature X"
```

#### 3. 文档审查

提交 PR 前，确保：

- [ ] 所有链接有效（内部和外部）
- [ ] 代码示例可以正常运行
- [ ] 术语使用一致
- [ ] 格式符合规范（emoji、代码块、表格等）
- [ ] 章节结构清晰
- [ ] 无拼写和语法错误

---

### 📝 文档审查检查清单

#### 内容检查

- [ ] **准确性**：信息是否准确，是否与代码实现一致
- [ ] **完整性**：是否包含所有必要信息
- [ ] **清晰性**：是否易于理解，是否有歧义
- [ ] **相关性**：内容是否与目标受众相关

#### 格式检查

- [ ] **章节标题**：是否使用正确的 emoji 标识
- [ ] **代码块**：是否使用正确的高亮（bash/yaml/go）
- [ ] **链接格式**：是否使用相对路径，格式是否一致
- [ ] **表格格式**：是否对齐，是否易读
- [ ] **列表格式**：是否使用正确的标记（`-` 或数字）

#### 链接检查

- [ ] **内部链接**：所有相对链接是否有效
- [ ] **外部链接**：所有外部链接是否可访问
- [ ] **锚点链接**：所有章节锚点是否正确

#### 代码示例检查

- [ ] **可执行性**：所有命令示例是否可以正常运行
- [ ] **准确性**：命令参数和选项是否正确
- [ ] **完整性**：是否包含必要的上下文信息

---

### 🔄 文档版本管理

#### 版本号规则

文档版本遵循语义化版本：

- **主版本（MAJOR）**：重大结构变更、删除章节
- **次版本（MINOR）**：新增章节、重大内容更新
- **修订号（PATCH）**：小修改、错误修复、格式调整

#### 版本记录

在文档末尾记录版本信息：

```markdown
---

**文档版本**：1.2.0
**最后更新**：2025-12-05
**维护者**：文档团队
```

#### 更新记录

对于重要更新，在文档中添加更新记录部分：

```markdown
## 🔄 更新记录

- **v1.2.0** (2025-12-05) - 添加新功能说明
- **v1.1.0** (2025-11-01) - 更新配置说明
- **v1.0.0** (2025-10-15) - 初始版本
```

---

### 🔍 文档链接验证方法

#### 手动验证

1. **检查相对链接**：
   ```bash
   # 在文档目录中查找所有链接
   grep -r "\[.*\](" docs/

   # 检查链接格式
   # 正确：`[文本](./path/to/file.md)`
   # 错误：`[文本](path/to/file.md)` (缺少 `./`)
   ```

2. **验证文件存在**：
   ```bash
   # 提取所有相对链接并检查文件是否存在
   grep -roh "\[.*\](\./[^)]*)" docs/ | sed 's/.*(\(.*\))/\1/' | sort -u
   ```

3. **检查锚点链接**：
   ```bash
   # 检查章节标题格式（用于锚点）
   grep "^##" docs/guidelines/usage/PR_GUIDELINES.md
   ```

#### 自动化验证（建议）

可以创建脚本自动验证：

```bash
#!/bin/bash
# scripts/verify-doc-links.sh

# 检查所有 Markdown 文件中的链接
find docs/ -name "*.md" -exec grep -l "\[.*\](" {} \; | while read file; do
  echo "Checking: $file"
  # 提取链接并验证
  # ...
done
```

---

### 📊 文档质量指标

#### 可读性指标

- **平均句子长度**：建议 15-20 个词
- **段落长度**：建议 3-5 句话
- **章节长度**：建议 200-500 行

#### 完整性指标

- **代码示例覆盖率**：每个主要功能至少 1 个示例
- **常见问题覆盖率**：至少 3-5 个常见问题
- **链接完整性**：所有功能都有链接到详细文档

#### 维护性指标

- **文档更新频率**：每次功能更新时同步更新
- **链接有效性**：定期检查（建议每月一次）
- **版本一致性**：文档版本与代码版本保持一致

---

### 🛠️ 文档维护工具

#### 推荐工具

1. **Markdown 链接检查器**：
   ```bash
   # 使用 markdown-link-check
   npm install -g markdown-link-check
   markdown-link-check docs/**/*.md
   ```

2. **拼写检查**：
   ```bash
   # 使用 cspell
   npm install -g cspell
   cspell "docs/**/*.md"
   ```

3. **格式检查**：
   ```bash
   # 使用 markdownlint
   npm install -g markdownlint-cli
   markdownlint docs/**/*.md
   ```

#### 定期维护任务

- **每周**：检查新 PR 中的文档更新
- **每月**：验证所有链接有效性
- **每季度**：审查文档结构，优化冗余内容
- **每版本发布**：更新 CHANGELOG.md 和相关文档

---

### 📚 相关文档

- [文档索引](../README.md) - 所有文档的索引
- [开发规范](./DEVELOPMENT_GUIDELINES.md) - 开发规范文档（同目录）

---

*文档版本：1.1.0*
*最后更新：2025-12-05*
